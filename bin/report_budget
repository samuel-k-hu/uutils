#!/usr/bin/perl

use strict;
use warnings;
use v5.36;
no warnings 'utf8';

use utf8;
if ($^O eq 'MSWin32') {
   binmode STDOUT, ':encoding(GBK)';
}

use Data::Dumper;

-e 'budgeting.tsv' or die "Can't find budgeting.tsv";
-e 'spending.tsv'  or die "Can't find spending.tsv";

my @report;

open my $budgeting, '<:encoding(UTF-8)',  'budgeting.tsv';
while (<$budgeting>) {
    chomp;
    my ( $item, $value ) = split /\t/;
    push @report,
      {
        'item'      => $item,
        'budgeting' => $value,
        'spending'  => 0
      };
}
close($budgeting);

open my $spending, '<:encoding(UTF-8)', 'spending.tsv';
while (<$spending>) {
    chomp;
    my ( $item, $value ) = split /\t/;
    foreach (@report) {
        $_->{'spending'} += $value if $_->{'item'} eq $item;
    }
}
close($spending);

my $bs = 0;
my $ss = 0;

foreach (@report) {
    print "$_->{'item'}\t";
    print "$_->{'budgeting'}\t";
    print "$_->{'spending'}\t";
    say $_->{'budgeting'} - $_->{'spending'};
    $bs += $_->{'budgeting'};
    $ss += $_->{'spending'};
}

say "总预算\t$bs";
say "总花销\t$ss";
say "结余\t", $bs - $ss;
